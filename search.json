[{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"get-started","dir":"Articles","previous_headings":"","what":"Get started","title":"Introduction to the cpi package","text":"Conditional Predictive Impact (CPI) general test conditional independence supervised learning algorithms. implements conditional variable importance measure can applied supervised learning algorithm loss function. first example, calculate CPI random forest wine data 5-fold cross validation: result CPI value feature, .e. much loss function change feature replaced knockoff version, corresponding standard errors, test statistics, p-values confidence interval. Note CPI value exactly 0 (e.g. feature never selected splitting tree), statistical test returns NA.","code":"library(mlr3) library(mlr3learners) library(cpi)  cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.ranger\", predict_type = \"prob\", num.trees = 10),     resampling = rsmp(\"cv\", folds = 5)) #>           Variable      CPI      SE test statistic estimate p.value    ci.lo #> 1       alcalinity  0.00106 0.00346    t      0.31  0.00106  0.3798 -0.00466 #> 2          alcohol  0.02759 0.01088    t      2.54  0.02759  0.0060  0.00961 #> 3              ash  0.00019 0.00019    t      1.00  0.00019  0.1593 -0.00012 #> 4            color  0.21308 0.18515    t      1.15  0.21308  0.1257 -0.09306 #> 5         dilution  0.00046 0.00771    t      0.06  0.00046  0.4761 -0.01229 #> 6       flavanoids  0.00000 0.00000    t        NA       NA      NA       NA #> 7              hue  0.00151 0.00705    t      0.21  0.00151  0.4155 -0.01015 #> 8        magnesium  0.00826 0.00494    t      1.67  0.00826  0.0480  0.00010 #> 9            malic  0.00047 0.00412    t      0.11  0.00047  0.4551 -0.00635 #> 10   nonflavanoids  0.00073 0.00205    t      0.36  0.00073  0.3612 -0.00266 #> 11         phenols -0.00351 0.00346    t     -1.01 -0.00351  0.8441 -0.00922 #> 12 proanthocyanins  0.00162 0.00389    t      0.42  0.00162  0.3389 -0.00481 #> 13         proline  0.08475 0.03003    t      2.82  0.08475  0.0027  0.03509"},{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"interface-with-mlr3","dir":"Articles","previous_headings":"","what":"Interface with mlr3","title":"Introduction to the cpi package","text":"task, learner resampling strategy specified mlr3 package, provides unified interface machine learning tasks makes quite easy change components. example, can change regularized logistic regression simple holdout resampling strategy: refer mlr3 book full introduction reference. loss function used cpi() function specified measure. default, mean squared error (MSE) used regression log-loss classification. mlr3, corresponds measures \"regr.mse\" \"classif.logloss\". re-run example simple classification error (ce): see NA values classification error less sensitive small changes hence results lower power.","code":"cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.glmnet\", predict_type = \"prob\", lambda = 0.01),     resampling = rsmp(\"holdout\")) #>           Variable      CPI      SE test statistic estimate p.value    ci.lo #> 1       alcalinity  8.6e-03 1.4e-02    t      0.62  8.6e-03   0.269 -1.5e-02 #> 2          alcohol  2.0e-02 1.4e-02    t      1.46  2.0e-02   0.074 -2.8e-03 #> 3              ash  3.1e-04 2.8e-04    t      1.11  3.1e-04   0.136 -1.6e-04 #> 4            color  3.2e-02 2.1e-02    t      1.57  3.2e-02   0.061 -2.2e-03 #> 5         dilution  8.2e-03 7.2e-03    t      1.15  8.2e-03   0.128 -3.8e-03 #> 6       flavanoids  4.0e-06 4.0e-06    t      1.01  4.0e-06   0.157 -2.6e-06 #> 7              hue  6.4e-03 8.1e-03    t      0.79  6.4e-03   0.217 -7.1e-03 #> 8        magnesium  0.0e+00 0.0e+00    t        NA       NA      NA       NA #> 9            malic -8.0e-03 9.3e-03    t     -0.85 -8.0e-03   0.802 -2.4e-02 #> 10   nonflavanoids -9.6e-04 2.9e-03    t     -0.33 -9.6e-04   0.627 -5.9e-03 #> 11         phenols  0.0e+00 0.0e+00    t        NA       NA      NA       NA #> 12 proanthocyanins  0.0e+00 0.0e+00    t        NA       NA      NA       NA #> 13         proline  3.5e-03 1.8e-02    t      0.19  3.5e-03   0.424 -2.7e-02 cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.glmnet\", lambda = 0.01),     resampling = rsmp(\"holdout\"),      measure = msr(\"classif.ce\")) #>           Variable    CPI    SE test statistic estimate p.value  ci.lo #> 1       alcalinity  0.000 0.000    t        NA       NA      NA     NA #> 2          alcohol  0.017 0.030    t      0.57    0.017    0.28 -0.032 #> 3              ash  0.000 0.000    t        NA       NA      NA     NA #> 4            color  0.000 0.000    t        NA       NA      NA     NA #> 5         dilution -0.017 0.017    t     -1.00   -0.017    0.84 -0.045 #> 6       flavanoids  0.000 0.000    t        NA       NA      NA     NA #> 7              hue  0.000 0.000    t        NA       NA      NA     NA #> 8        magnesium -0.017 0.017    t     -1.00   -0.017    0.84 -0.045 #> 9            malic -0.017 0.017    t     -1.00   -0.017    0.84 -0.045 #> 10   nonflavanoids -0.017 0.017    t     -1.00   -0.017    0.84 -0.045 #> 11         phenols  0.000 0.000    t        NA       NA      NA     NA #> 12 proanthocyanins  0.000 0.000    t        NA       NA      NA     NA #> 13         proline  0.017 0.045    t      0.38    0.017    0.35 -0.059"},{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"statistical-testing","dir":"Articles","previous_headings":"","what":"Statistical testing","title":"Introduction to the cpi package","text":"CPI offers several statistical tests calculated: t-test (\"t\", default), Wilcoxon signed-rank test (\"wilcox\"), binomial test (\"binom\"), Fisher permutation test (\"fisher\") Bayesian testing (\"bayes\") package BEST. example, re-run first example Fisher’s permutation test:","code":"cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.ranger\", predict_type = \"prob\", num.trees = 10),     resampling = rsmp(\"cv\", folds = 5),      test = \"fisher\") #>           Variable      CPI      SE   test p.value    ci.lo #> 1       alcalinity  0.00864 0.00441 fisher  0.0255  0.00131 #> 2          alcohol  0.02225 0.01082 fisher  0.0180  0.00459 #> 3              ash  0.00000 0.00000 fisher      NA       NA #> 4            color  0.03918 0.01555 fisher  0.0040  0.01390 #> 5         dilution  0.00864 0.00780 fisher  0.1395 -0.00435 #> 6       flavanoids -0.00039 0.00039 fisher  1.0000 -0.00078 #> 7              hue  0.00720 0.00738 fisher  0.1700 -0.00473 #> 8        magnesium  0.00344 0.00366 fisher  0.1635 -0.00249 #> 9            malic  0.01378 0.00394 fisher  0.0005  0.00700 #> 10   nonflavanoids -0.00118 0.00289 fisher  0.6405 -0.00614 #> 11         phenols -0.00192 0.00431 fisher  0.6695 -0.00938 #> 12 proanthocyanins  0.00926 0.00476 fisher  0.0220  0.00128 #> 13         proline  0.05066 0.01421 fisher  0.0005  0.02737"},{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"knockoff-procedures","dir":"Articles","previous_headings":"","what":"Knockoff procedures","title":"Introduction to the cpi package","text":"CPI relies valid knockoff sampler data analyzed. default, second-order Gaussian knockoffs package knockoff used. However, knockoff sampler can used changing knockoff_fun x_tilde argument cpi() function. , knockoff_fun expects function taking data.frame original data input returning data.frame knockoffs. example, use sequential knockoffs seqknockoff package1: x_tilde argument directly takes knockoff data:","code":"mytask <- as_task_regr(iris, target = \"Petal.Length\") cpi(task = mytask, learner = lrn(\"regr.ranger\", num.trees = 10),      resampling = rsmp(\"cv\", folds = 5),      knockoff_fun = seqknockoff::knockoffs_seq) library(seqknockoff) x_tilde <- knockoffs_seq(iris[, -3]) mytask <- as_task_regr(iris, target = \"Petal.Length\") cpi(task = mytask, learner = lrn(\"regr.ranger\", num.trees = 10),      resampling = rsmp(\"cv\", folds = 5),      x_tilde = x_tilde)"},{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"group-cpi","dir":"Articles","previous_headings":"","what":"Group CPI","title":"Introduction to the cpi package","text":"Instead calculating CPI feature separately, can also calculate groups features replacing data whole groups respective knockoff data. cpi() can done groups argument:","code":"cpi(task = tsk(\"iris\"),      learner = lrn(\"classif.glmnet\", predict_type = \"prob\", lambda = 0.01),     resampling = rsmp(\"holdout\"),      groups = list(Sepal = 1:2, Petal = 3:4)) #>   Group    CPI    SE test statistic estimate p.value   ci.lo #> 1 Sepal 0.0033 0.009    t      0.37   0.0033   0.358 -0.0118 #> 2 Petal 0.0192 0.011    t      1.82   0.0192   0.037  0.0015"},{"path":"https://dswatson.github.io/cpi/articles/intro.html","id":"parallelization","dir":"Articles","previous_headings":"","what":"Parallelization","title":"Introduction to the cpi package","text":"parallel execution, need register parallel backend. Parallelization performed features, .e. CPI feature calculated parallel. example:","code":"doParallel::registerDoParallel(4) cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.ranger\", predict_type = \"prob\", num.trees = 10),     resampling = rsmp(\"cv\", folds = 5))"},{"path":"https://dswatson.github.io/cpi/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Marvin N. Wright. Author, maintainer. David S. Watson. Author.","code":""},{"path":"https://dswatson.github.io/cpi/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Watson, D.S. & Wright, M.N. (2021). Testing conditional independence supervised learning algorithms. Machine Learning 110(8):2107-2129. doi:10.1007/s10994-021-06030-6","code":"@Article{,   title = {Testing conditional independence in supervised learning algorithms},   author = {David S. Watson and Marvin N. Wright},   journal = {Machine Learning},   year = {2011},   volume = {110},   number = {8},   pages = {2107--2129},   url = {https://doi.org/10.1007/s10994-021-06030-6}, }"},{"path":"https://dswatson.github.io/cpi/index.html","id":"conditional-predictive-impact","dir":"","previous_headings":"","what":"Conditional Predictive Impact","title":"Conditional Predictive Impact","text":"David S. Watson, Marvin N. Wright","code":""},{"path":"https://dswatson.github.io/cpi/index.html","id":"introduction","dir":"","previous_headings":"Conditional Predictive Impact","what":"Introduction","title":"Conditional Predictive Impact","text":"conditional predictive impact (CPI) measure conditional independence. can calculated using supervised learning algorithm, loss function, knockoff sampler. provide statistical inference procedures CPI without parametric assumptions sparsity constraints. method works continuous categorical data.","code":""},{"path":"https://dswatson.github.io/cpi/index.html","id":"installation","dir":"","previous_headings":"Conditional Predictive Impact","what":"Installation","title":"Conditional Predictive Impact","text":"package CRAN yet. install development version GitHub using devtools, run","code":"devtools::install_github(\"dswatson/cpi\")"},{"path":"https://dswatson.github.io/cpi/index.html","id":"examples","dir":"","previous_headings":"Conditional Predictive Impact","what":"Examples","title":"Conditional Predictive Impact","text":"Calculate CPI random forest iris data 5-fold cross validation:","code":"library(mlr3) library(mlr3learners) library(cpi)  cpi(task = tsk(\"iris\"),      learner = lrn(\"classif.ranger\", predict_type = \"prob\"),     resampling = rsmp(\"cv\", folds = 5),      measure = \"classif.logloss\", test = \"t\")"},{"path":"https://dswatson.github.io/cpi/index.html","id":"references","dir":"","previous_headings":"Conditional Predictive Impact","what":"References","title":"Conditional Predictive Impact","text":"Watson D. S. & Wright, M. N. (2021). Testing conditional independence supervised learning algorithms. Machine Learning. DOI: 10.1007/s10994-021-06030-6.","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":null,"dir":"Reference","previous_headings":"","what":"Conditional Predictive Impact (CPI). — cpi","title":"Conditional Predictive Impact (CPI). — cpi","text":"general test conditional  independence supervised learning algorithms. Implements conditional  variable importance measure can applied supervised learning  algorithm loss function. Provides statistical inference procedures  without parametric assumptions applies equally well continuous  categorical predictors outcomes.","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Conditional Predictive Impact (CPI). — cpi","text":"","code":"cpi(   task,   learner,   resampling = NULL,   test_data = NULL,   measure = NULL,   test = \"t\",   log = FALSE,   B = 1999,   alpha = 0.05,   x_tilde = NULL,   knockoff_fun = function(x) knockoff::create.second_order(as.matrix(x)),   groups = NULL,   verbose = FALSE )"},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Conditional Predictive Impact (CPI). — cpi","text":"task prediction mlr3 task, see examples. learner mlr3 learner used CPI. pass string,  learner created via mlr3::lrn. resampling Resampling strategy, mlr3 resampling object  (e.g. rsmp(\"holdout\")), \"oob\" (--bag) \"none\"  (-sample loss). test_data External validation data, use instead resampling. measure Performance measure (loss). Per default, use MSE  (\"regr.mse\") regression logloss (\"classif.logloss\")  classification. test Statistical test perform, one \"t\" (t-test, default),  \"wilcox\" (Wilcoxon signed-rank test), \"binom\" (binomial  test), \"fisher\" (Fisher permutation test) \"bayes\"  (Bayesian testing, computationally intensive!). See Details. log Set TRUE multiplicative CPI (\\(\\lambda\\)),  FALSE (default) additive CPI (\\(\\Delta\\)). B Number permutations Fisher permutation test. alpha Significance level confidence intervals. x_tilde Knockoff matrix data.frame. given (default),  created function given knockoff_fun. knockoff_fun Function generate knockoffs. Default:  knockoff::create.second_order matrix argument. groups (Named) list groups. Set NULL (default) groups, .e. compute CPI feature. See examples. verbose Verbose output resampling procedure.","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Conditional Predictive Impact (CPI). — cpi","text":"test = \"bayes\" list BEST objects.  case, data.frame row feature columns: Variable/Group Variable/group name CPI CPI value SE Standard error test Testing method statistic Test statistic (t-test, Wilcoxon binomial test) estimate Estimated mean (t-test), median (Wilcoxon test),     proportion \\(\\Delta\\)-values greater 0 (binomial test). p.value p-value ci.lo Lower limit (1 - alpha) * 100% confidence interval Note NA values error result CPI value 0, .e.  difference model performance replacing feature knockoff.","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Conditional Predictive Impact (CPI). — cpi","text":"function computes conditional predictive impact (CPI) one several features given supervised learning task. represents  mean error inflation replacing true variable knockoff. Large CPI values evidence feature(s) question high  conditional variable importance -- .e., fitted model relies  feature(s) predict outcome, even accounting signal remaining covariates. build mlr3 framework, provides unified interface  training models, specifying loss functions, estimating generalization  error. See package documentation info. Methods implemented frequentist Bayesian inference. default test = \"t\", fast powerful sample sizes. Wilcoxon signed-rank test (test = \"wilcox\") may appropriate  CPI distribution skewed, binomial test (test = \"binom\")  requires basically assumptions may less power. small sample  sizes, recommend permutation tests (test = \"fisher\") Bayesian  methods (test = \"bayes\"). latter case, default priors  assumed. See BEST package info. parallel execution, register backend, e.g. doParallel::registerDoParallel().","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Conditional Predictive Impact (CPI). — cpi","text":"Watson, D. & Wright, M. (2020). Testing conditional independence  supervised learning algorithms. Machine Learning, 110(8):  2107-2129. doi: 10.1007/s10994-021-06030-6 Candès, E., Fan, Y., Janson, L, & Lv, J. (2018). Panning gold: 'model-X' knockoffs high dimensional controlled variable selection. J. R.  Statistc. Soc. B, 80(3): 551-577. doi: 10.1111/rssb.12265","code":""},{"path":"https://dswatson.github.io/cpi/reference/cpi.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Conditional Predictive Impact (CPI). — cpi","text":"","code":"library(mlr3) library(mlr3learners)  # Regression with linear model and cross validation cpi(task = tsk(\"mtcars\"), learner = lrn(\"regr.lm\"),      resampling = rsmp(\"cv\", folds = 3)) #>    Variable           CPI           SE test  statistic      estimate    p.value #> 1        am  2.0937882624 2.3704402320    t  0.8832909  2.0937882624 0.19193902 #> 2      carb  0.0010516053 0.0010276214    t  1.0233393  0.0010516053 0.15703363 #> 3       cyl -2.7983265533 3.3723318255    t -0.8297898 -2.7983265533 0.79349888 #> 4      disp  0.0007107517 0.0004953829    t  1.4347523  0.0007107517 0.08068506 #> 5      drat -0.5428570498 1.9921410728    t -0.2724993 -0.5428570498 0.60647746 #> 6      gear -1.0602507626 2.4075675504    t -0.4403826 -1.0602507626 0.66864218 #> 7        hp  0.9483967670 1.1057604047    t  0.8576874  0.9483967670 0.19882390 #> 8      qsec -2.6971620059 1.0455516315    t -2.5796545 -2.6971620059 0.99257280 #> 9        vs -0.4887006141 0.5005930139    t -0.9762434 -0.4887006141 0.83174949 #> 10       wt  1.4920799072 0.9792042745    t  1.5237678  1.4920799072 0.06885216 #>            ci.lo #> 1  -1.9253376738 #> 2  -0.0006907460 #> 3  -8.5161785044 #> 4  -0.0001291793 #> 5  -3.9205696561 #> 6  -5.1423267645 #> 7  -0.9264407682 #> 8  -4.4699144353 #> 9  -1.3374654716 #> 10 -0.1681793322  # Classification with logistic regression, log-loss and holdout cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.glmnet\", predict_type = \"prob\", lambda = 0.1),      resampling = rsmp(\"holdout\"),      measure = \"classif.logloss\", test = \"t\") #>           Variable           CPI           SE test  statistic      estimate #> 1       alcalinity  0.000000e+00 0.000000e+00    t         NA            NA #> 2          alcohol  1.714625e-02 2.613664e-02    t  0.6560236  1.714625e-02 #> 3              ash -2.109346e-04 1.310647e-04    t -1.6093929 -2.109346e-04 #> 4            color -7.335296e-03 7.469413e-03    t -0.9820444 -7.335296e-03 #> 5         dilution  7.459657e-03 1.190794e-02    t  0.6264439  7.459657e-03 #> 6       flavanoids  4.251607e-06 6.834456e-06    t  0.6220841  4.251607e-06 #> 7              hue -1.513232e-02 4.861189e-03    t -3.1128844 -1.513232e-02 #> 8        magnesium  0.000000e+00 0.000000e+00    t         NA            NA #> 9            malic  0.000000e+00 0.000000e+00    t         NA            NA #> 10   nonflavanoids  0.000000e+00 0.000000e+00    t         NA            NA #> 11         phenols  0.000000e+00 0.000000e+00    t         NA            NA #> 12 proanthocyanins  0.000000e+00 0.000000e+00    t         NA            NA #> 13         proline  8.470017e-02 3.254481e-02    t  2.6025710  8.470017e-02 #>        p.value         ci.lo #> 1           NA            NA #> 2  0.257201546 -2.654252e-02 #> 3  0.943519752 -4.300162e-04 #> 4  0.834921586 -1.982081e-02 #> 5  0.266740865 -1.244510e-02 #> 6  0.268162224 -7.172547e-06 #> 7  0.998562274 -2.325805e-02 #> 8           NA            NA #> 9           NA            NA #> 10          NA            NA #> 11          NA            NA #> 12          NA            NA #> 13 0.005863385  3.029981e-02   # Use your own data (and out-of-bag loss with random forest) mytask <- as_task_classif(iris, target = \"Species\") mylearner <- lrn(\"classif.ranger\", predict_type = \"prob\", keep.inbag = TRUE) cpi(task = mytask, learner = mylearner,      resampling = \"oob\", measure = \"classif.logloss\") #>       Variable           CPI           SE test   statistic      estimate #> 1 Petal.Length -0.0011761887 2.415653e-03    t -0.48690293 -0.0011761887 #> 2  Petal.Width  0.0222341607 1.689977e-02    t  1.31564883  0.0222341607 #> 3 Sepal.Length  0.0001359298 9.367711e-05    t  1.45104629  0.0001359298 #> 4  Sepal.Width -0.0001863727 2.960072e-03    t -0.06296222 -0.0001863727 #>      p.value         ci.lo #> 1 0.68647869 -5.174444e-03 #> 2 0.09515635 -5.737399e-03 #> 3 0.07443453 -1.911933e-05 #> 4 0.52505951 -5.085720e-03      # Group CPI cpi(task = tsk(\"iris\"),      learner = lrn(\"classif.ranger\", predict_type = \"prob\", num.trees = 10),      resampling = rsmp(\"cv\", folds = 3),      groups = list(Sepal = 1:2, Petal = 3:4)) #>   Group         CPI          SE test statistic    estimate   p.value #> 1 Sepal 0.212184944 0.211525686    t 1.0031167 0.212184944 0.1587154 #> 2 Petal 0.002815219 0.003470821    t 0.8111105 0.002815219 0.2092980 #>          ci.lo #> 1 -0.137920639 #> 2 -0.002929491      if (FALSE) { # Bayesian testing res <- cpi(task = tsk(\"iris\"),             learner = lrn(\"classif.glmnet\", predict_type = \"prob\", lambda = 0.1),             resampling = rsmp(\"holdout\"),             measure = \"classif.logloss\", test = \"bayes\") plot(res$Petal.Length)  # Parallel execution doParallel::registerDoParallel() cpi(task = tsk(\"wine\"),      learner = lrn(\"classif.glmnet\", predict_type = \"prob\", lambda = 0.1),      resampling = rsmp(\"cv\", folds = 5))      # Use sequential knockoffs for categorical features # package available here: https://github.com/kormama1/seqknockoff mytask <- as_task_regr(iris, target = \"Petal.Length\") cpi(task = mytask, learner = lrn(\"regr.ranger\"),      resampling = rsmp(\"holdout\"),      knockoff_fun = seqknockoff::knockoffs_seq) }"},{"path":"https://dswatson.github.io/cpi/news/index.html","id":"cpi-010","dir":"Changelog","previous_headings":"","what":"cpi 0.1.0","title":"cpi 0.1.0","text":"Migrate mlr3 framework Allow data.frame inputs Add interface knockoff samplers Add group CPI","code":""}]
