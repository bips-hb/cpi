<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Conditional Predictive Impact (CPI). — cpi • cpi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conditional Predictive Impact (CPI). — cpi"><meta name="description" content="A general test for conditional
independence in supervised learning algorithms. Implements a conditional
variable importance measure which can be applied to any supervised learning
algorithm and loss function. Provides statistical inference procedures
without parametric assumptions and applies equally well to continuous and
categorical predictors and outcomes."><meta property="og:description" content="A general test for conditional
independence in supervised learning algorithms. Implements a conditional
variable importance measure which can be applied to any supervised learning
algorithm and loss function. Provides statistical inference procedures
without parametric assumptions and applies equally well to continuous and
categorical predictors and outcomes."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cpi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro.html">Introduction to the cpi package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bips-hb/cpi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Conditional Predictive Impact (CPI).</h1>
      <small class="dont-index">Source: <a href="https://github.com/bips-hb/cpi/blob/master/R/cpi.R" class="external-link"><code>R/cpi.R</code></a></small>
      <div class="d-none name"><code>cpi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A general test for conditional
independence in supervised learning algorithms. Implements a conditional
variable importance measure which can be applied to any supervised learning
algorithm and loss function. Provides statistical inference procedures
without parametric assumptions and applies equally well to continuous and
categorical predictors and outcomes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cpi</span><span class="op">(</span></span>
<span>  <span class="va">task</span>,</span>
<span>  <span class="va">learner</span>,</span>
<span>  resampling <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  test_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  measure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"t"</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1999</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  x_tilde <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  aggr_fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  knockoff_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">knockoff</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knockoff/man/create.second_order.html" class="external-link">create.second_order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-task">task<a class="anchor" aria-label="anchor" href="#arg-task"></a></dt>
<dd><p>The prediction <code>mlr3</code> task, see examples.</p></dd>


<dt id="arg-learner">learner<a class="anchor" aria-label="anchor" href="#arg-learner"></a></dt>
<dd><p>The <code>mlr3</code> learner used in CPI. If you pass a string, the
learner will be created via <code>mlr3::<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></code>.</p></dd>


<dt id="arg-resampling">resampling<a class="anchor" aria-label="anchor" href="#arg-resampling"></a></dt>
<dd><p>Resampling strategy, <code>mlr3</code> resampling object
(e.g. <code>rsmp("holdout")</code>), "oob" (out-of-bag) or "none"
(in-sample loss).</p></dd>


<dt id="arg-test-data">test_data<a class="anchor" aria-label="anchor" href="#arg-test-data"></a></dt>
<dd><p>External validation data, use instead of resampling.</p></dd>


<dt id="arg-measure">measure<a class="anchor" aria-label="anchor" href="#arg-measure"></a></dt>
<dd><p>Performance measure (loss). Per default, use MSE
(<code>"regr.mse"</code>) for regression and logloss (<code>"classif.logloss"</code>)
for classification.</p></dd>


<dt id="arg-test">test<a class="anchor" aria-label="anchor" href="#arg-test"></a></dt>
<dd><p>Statistical test to perform, one of <code>"t"</code> (t-test, default),
<code>"wilcox"</code> (Wilcoxon signed-rank test), <code>"binom"</code> (binomial
test), <code>"fisher"</code> (Fisher permutation test) or "bayes"
(Bayesian testing, computationally intensive!). See Details.</p></dd>


<dt id="arg-log">log<a class="anchor" aria-label="anchor" href="#arg-log"></a></dt>
<dd><p>Set to <code>TRUE</code> for multiplicative CPI (\(\lambda\)), to
<code>FALSE</code> (default) for additive CPI (\(\Delta\)).</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of permutations for Fisher permutation test.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Significance level for confidence intervals.</p></dd>


<dt id="arg-x-tilde">x_tilde<a class="anchor" aria-label="anchor" href="#arg-x-tilde"></a></dt>
<dd><p>Knockoff matrix or data.frame. If not given (the default), it will be
created with the function given in <code>knockoff_fun</code>.
Also accepts a list of matrices or data.frames.</p></dd>


<dt id="arg-aggr-fun">aggr_fun<a class="anchor" aria-label="anchor" href="#arg-aggr-fun"></a></dt>
<dd><p>Aggregation function over replicates.</p></dd>


<dt id="arg-knockoff-fun">knockoff_fun<a class="anchor" aria-label="anchor" href="#arg-knockoff-fun"></a></dt>
<dd><p>Function to generate knockoffs. Default:
<code>knockoff::<a href="https://rdrr.io/pkg/knockoff/man/create.second_order.html" class="external-link">create.second_order</a></code> with matrix argument.</p></dd>


<dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>(Named) list with groups. Set to <code>NULL</code> (default) for no
groups, i.e. compute CPI for each feature. See examples.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Verbose output of resampling procedure.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>test = "bayes"</code> a list of <code>BEST</code> objects. In any other
case, a <code>data.frame</code> with a row for each feature and columns:</p>
<dl><dt>Variable/Group</dt>
<dd><p>Variable/group name</p></dd>

  <dt>CPI</dt>
<dd><p>CPI value</p></dd>

  <dt>SE</dt>
<dd><p>Standard error</p></dd>

  <dt>test</dt>
<dd><p>Testing method</p></dd>

  <dt>statistic</dt>
<dd><p>Test statistic (only for t-test, Wilcoxon and binomial test)</p></dd>

  <dt>estimate</dt>
<dd><p>Estimated mean (for t-test), median (for Wilcoxon test),
    or proportion of \(\Delta\)-values greater than 0 (for binomial test).</p></dd>

  <dt>p.value</dt>
<dd><p>p-value</p></dd>

  <dt>ci.lo</dt>
<dd><p>Lower limit of (1 - <code>alpha</code>) * 100% confidence interval</p></dd>

</dl><p>Note that NA values are no error but a result of a CPI value of 0, i.e. no
difference in model performance after replacing a feature with its knockoff.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function computes the conditional predictive impact (CPI) of one or
several features on a given supervised learning task. This represents the
mean error inflation when replacing a true variable with its knockoff. Large
CPI values are evidence that the feature(s) in question have high
<em>conditional variable importance</em> – i.e., the fitted model relies on
the feature(s) to predict the outcome, even after accounting for the signal
from all remaining covariates.</p>
<p>We build on the <code>mlr3</code> framework, which provides a unified interface for
training models, specifying loss functions, and estimating generalization
error. See the package documentation for more info.</p>
<p>Methods are implemented for frequentist and Bayesian inference. The default
is <code>test = "t"</code>, which is fast and powerful for most sample sizes. The
Wilcoxon signed-rank test (<code>test = "wilcox"</code>) may be more appropriate if
the CPI distribution is skewed, while the binomial test (<code>test = "binom"</code>)
requires basically no assumptions but may have less power. For small sample
sizes, we recommend permutation tests (<code>test = "fisher"</code>) or Bayesian
methods (<code>test = "bayes"</code>). In the latter case, default priors are
assumed. See the <code>BEST</code> package for more info.</p>
<p>For parallel execution, register a backend, e.g. with
<code><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">doParallel::registerDoParallel()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Watson, D. &amp; Wright, M. (2020). Testing conditional independence in
supervised learning algorithms. <em>Machine Learning</em>, <em>110</em>(8):
2107-2129. <a href="https://doi.org/10.1007/s10994-021-06030-6" class="external-link">doi:10.1007/s10994-021-06030-6</a></p>
<p>Candès, E., Fan, Y., Janson, L, &amp; Lv, J. (2018). Panning for gold: 'model-X'
knockoffs for high dimensional controlled variable selection. <em>J. R.
Statistc. Soc. B</em>, <em>80</em>(3): 551-577. <a href="https://doi.org/10.1111/rssb.12265" class="external-link">doi:10.1111/rssb.12265</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Regression with linear model and holdout validation</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span>, learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.lm"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Variable           CPI           SE test    statistic      estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        am  1.511269e-01 0.1353364697    t  1.116675090  1.511269e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      carb  7.177261e-04 0.0008040053    t  0.892688274  7.177261e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       cyl -1.603035e+00 1.9235839396    t -0.833358373 -1.603035e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      disp -2.837083e-05 0.0002846269    t -0.099677272 -2.837083e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      drat -9.169321e-01 1.4362550982    t -0.638418689 -9.169321e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      gear -1.684137e-03 1.1431889217    t -0.001473192 -1.684137e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        hp  1.335019e-01 0.1400283892    t  0.953391640  1.335019e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      qsec -3.821204e-01 0.3403810736    t -1.122625382 -3.821204e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        vs -7.696940e-03 0.3517929711    t -0.021879176 -7.696940e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       wt  5.575406e-01 2.3763168665    t  0.234623843  5.575406e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      p.value         ci.lo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.1451227 -0.0941652253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  0.1964996 -0.0007395023</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.7879499 -5.0894558899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.5387148 -0.0005442460</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.7312266 -3.5200886244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.5005732 -2.0736696136</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  0.1814342 -0.1202941158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  0.8560866 -0.9990478958</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  0.5085126 -0.6453080236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 0.4096175 -3.7494413417</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Classification with logistic regression, log-loss and t-test</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"wine"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.glmnet"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    measure <span class="op">=</span> <span class="st">"classif.logloss"</span>, test <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Variable           CPI           SE test  statistic      estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       alcalinity -2.483667e-04 2.439210e-03    t -0.1018226 -2.483667e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          alcohol  3.759549e-02 1.867277e-02    t  2.0133854  3.759549e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3              ash  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            color  1.706278e-02 8.204707e-03    t  2.0796326  1.706278e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         dilution  4.240278e-03 5.754550e-03    t  0.7368565  4.240278e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       flavanoids -2.073059e-05 8.422713e-06    t -2.4612727 -2.073059e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7              hue  1.691236e-03 6.249021e-03    t  0.2706402  1.691236e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        magnesium  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            malic  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   nonflavanoids  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11         phenols  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 proanthocyanins  0.000000e+00 0.000000e+00    t  0.0000000  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         proline  5.492125e-02 3.268019e-02    t  1.6805672  5.492125e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       p.value         ci.lo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.54037566 -0.0043256347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  0.02436121  0.0063829647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.02099470  0.0033481760</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.23208994 -0.0053787561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.99157962 -0.0000348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  0.39381429 -0.0087543320</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 1.00000000  0.0000000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 0.04911281  0.0002945923</span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span><span class="co"># Use your own data (and out-of-bag loss with random forest)</span></span></span>
<span class="r-in"><span><span class="va">mytask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_classif.html" class="external-link">as_task_classif</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mylearner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, keep.inbag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="va">mytask</span>, learner <span class="op">=</span> <span class="va">mylearner</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="st">"oob"</span>, measure <span class="op">=</span> <span class="st">"classif.logloss"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Variable           CPI           SE test  statistic      estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Petal.Length -0.0003107344 0.0001992726    t -1.5593433 -0.0003107344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Petal.Width -0.0073844725 0.0228868112    t -0.3226519 -0.0073844725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Sepal.Length -0.0004196657 0.0004036849    t -1.0395874 -0.0004196657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  Sepal.Width -0.0019064194 0.0046740547    t -0.4078727 -0.0019064194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     p.value         ci.lo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.9394817 -0.0006405593</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.6262944 -0.0452654530</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.8498922 -0.0010878225</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.6580237 -0.0096426555</span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="co"># Group CPI</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, num.trees <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Sepal <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, Petal <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Group          CPI          SE test  statistic     estimate   p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Sepal -0.001893357 0.007294353    t -0.2595647 -0.001893357 0.6022211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Petal  0.002692659 0.003528954    t  0.7630190  0.002692659 0.2233292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ci.lo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -0.01396657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.00314827</span>
<span class="r-in"><span><span class="co"># }     </span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{      </span></span></span>
<span class="r-in"><span><span class="co"># Bayesian testing</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.glmnet"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           measure <span class="op">=</span> <span class="st">"classif.logloss"</span>, test <span class="op">=</span> <span class="st">"bayes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">Petal.Length</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Parallel execution</span></span></span>
<span class="r-in"><span><span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"wine"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.glmnet"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span>, lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="co"># Use sequential knockoffs for categorical features</span></span></span>
<span class="r-in"><span><span class="co"># package available here: https://github.com/kormama1/seqknockoff</span></span></span>
<span class="r-in"><span><span class="va">mytask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html" class="external-link">as_task_regr</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="st">"Petal.Length"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">cpi</span><span class="op">(</span>task <span class="op">=</span> <span class="va">mytask</span>, learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    knockoff_fun <span class="op">=</span> <span class="fu">seqknockoff</span><span class="fu">::</span><span class="va">knockoffs_seq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }   </span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marvin N. Wright, David S. Watson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

